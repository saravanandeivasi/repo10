---
  - name: create a new instance on amazon
    ec2:
     aws_access_key: AKIASX7WFWRFALYONC66
     aws_secret_key: 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
     key_name: "{{key}}"
     instance_type: "{{instancetype}}"
     image: "{{ami}}"
     wait: yes
     group:
     count: 1
     vpc_subnet_id: subnet-070d6d35334487f68
     assign_public_ip: yes
     region: "{{region}}"
     instance_tags:
      Name: ansible_nodes
    register: ec2_info
  - debug:
          msg: "{{ec2_info}}"

  - name: Create a new Security Group
    ec2_group:
     name: ec2-sg
     description: allow Ports
     region: "{{region}}"
     rules:
      - proto: tcp
        from_port: 80
        to_port: 80
        cidr_ip: 0.0.0.0/0

      - proto: tcp
        from_port: 22
        to_port: 22
        cidr_ip: 0.0.0.0/0

      - proto: tcp
        from_port: 443
        to_port: 443
        cidr_ip: 0.0.0.0/0
        
   register: ec2-sg         